<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CDU Course Management System</title>

    <link rel="shortcut icon" href="assets/img/favicon.ico" />

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <style>
        h5.title {
            margin: 1.2rem;
            text-align: center;
            background: #ececec;
            padding: 20px;
            border-radius: 8px;
        }

        a {
            text-decoration: none !important;
            color:#000000;
        }

        .breadcrumb-item+.breadcrumb-item::before {
            content: "Â»";
        }

        .pointerCursor {
             cursor: pointer;
        }

        th, td {
            text-align: center;
        }

        th, td {
            white-space: nowrap;
        }

        td, select.form-control, input.form-control {
            font-size: 15px;
        }

        input[type=checkbox] {
            font-size: 5px;
        }

        
        .sticky {
            position: -webkit-sticky;
            position: sticky;
            top: 0;
            padding: 0px;
            font-size: 20px;
            z-index: 142;
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <nav class="navbar navbar-expand-sm bg-white">
                <div class="navbar-header">
                    <a class="nav-link" href="/">
                        <img class="img-fluid" src="assets/img/logo.jpg" alt="">
                    </a>
                </div>
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item">
                        <h5 class="title">CDU Course Management System</h5>
                    </li>
                </ul>
                </nav>
            </div>
        </div>
        <hr>

        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"></li>
                <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                <li class="breadcrumb-item" id="currentDegree"><a href="#"></a></li>
                <li class="breadcrumb-item" id="currentCourse"><a href="#"></a></li>
                <li class="breadcrumb-item" id="currentSpecialization"><a href="#"></a></li>
                <li class="breadcrumb-item" id="currentSpecDetails"><a href="#"></a></li>
                <li class="breadcrumb-item active" aria-current="page" id="currentStudentStatus"></li>
            </ol>
        </nav>

        
        <hr>
        
        
        <div class="col-md-12 sticky">
            <div class="card">
                <div class="card-body" style="background: rgb(0,122,135); color: whitesmoke;">
                        <div class="row">
                            <div class="col-md-6">
                            <span style="background: #fd9494; border: 1px solid; padding: 0px 10px; margin: auto 10px;"></span> Cannot choose in this semester.
                            </div>
                            <div class="col-md-6">
                            <span style="background: #ffd9b1; border: 1px solid; padding: 0px 10px; margin: auto 10px;"></span> Need prerequisites.
                            </div>
                            <div class="col-md-6">
                            <span style="background: #bcffc1; border: 1px solid; padding: 0px 10px; margin: auto 10px;"></span> Selected units for coming semester.
                            </div>
                            <div class="col-md-6">
                            <span style="background: #bed8ff; border: 1px solid; padding: 0px 10px; margin: auto 10px;"></span> Completed units.
                            </div>

                        </div>
                </div>
            </div>
        </div>

        <div class="row">
           <div class="col-md-12">
                <div class="pb-2 mt-4 mb-2">
                    <h4 class="text-center" id="currentStudentStatusTitle"></h4>
               </div>
           </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead id="showLegend">
                            <!-- <tr style="background-color: #211545; color: white;">
                                <th>Legend</th>
                                <th>CU = Common Unit</th>
                                <th>CO = Core Unit</th>
                                <th>SE = Specialist Elective</th>
                                <th>E = Elective</th>
                            </tr> -->
                        </thead>
                    </table>
                </div>

                <br>
                <!-- <div class="row">
                    <div class="col-md-12">
                        <div class="pb-2 mt-4 mb-2">
                            <h4 class="text-center">Studied Units</h4>
                        </div>
                    </div>
                </div>
                <hr>
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <tbody id="studiedTable">
                        </tbody>
                    </table>
                </div>
                <hr>
                <div class="row">
                    <div class="col-md-12">
                        <div class="pb-2 mt-4 mb-2">
                            <h4 class="text-center">Selected Units</h4>
                        </div>
                    </div>
                </div>
                <hr>
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <tbody id="chosenTable">
                        </tbody>
                    </table>
                </div>
                <hr> -->
                <div class="row">
                    <div class="col-md-12">
                        <div class="pb-2 mt-4 mb-2">
                            <h4 class="text-center">Remaining Units</h4>
                        </div>
                    </div>
                </div>
                <hr>
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <tbody id="remainingTable">
                            <tr style="background-color: #dc8633">
                                <td colspan="2">
                                    <h5>Semester One</h5>
                                </td>
                                <td colspan="2">
                                    <h5>Semester Two</h5>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <hr>
            
                <div class="col-md-6 text-left">
                    <button class="btn btn-info" onclick="onBack()">Back</button>
                </div>
    
                <hr>

                <div class="col-md-12">
                    <div class="pb-2 mt-4 mb-2">
                        <h4 class="text-center">Course Summary</h4>
                    </div>
                </div>

                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead id="courseSummaryHead">
                            <!-- <tr class="no-wrap" style="background-color: #007a87; color: white;">
                                <th>Total Credit</th>
                                <th>CU & CO</th>
                                <th>Specialist Elective</th>
                                <th>Elective</th>
                                <th>Total Remaining</th>
                            </tr> -->
                        </thead>
                        <tbody id="courseSummaryBody">
                            <!-- <tr style="background-color: #FCFFFF">
                                <th>240</th>
                                <th id="cocuCredit"></th>
                                <th id="specialElectiveCredit"></th>
                                <th id="electiveCredit"></th>
                                <th id="totalRemainingCredit"></th>
                            </tr> -->
                        </tbody>
                    </table>
                </div>

                <div id="alertSE">

                </div>
            </div>

            <div class="col-md-12">
                <hr>
            </div>
        </div>
    </div>

<script src="http://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
    const currentSelectedUnits = JSON.parse(localStorage.getItem('currentStudiedUnits'));
    const currentStudiedUnits = JSON.parse(localStorage.getItem('currentSelectedUnits'));

    var totalUnits = { "co_cu": [], "elective": [], "seElective": [] };
    
    for(var i = 0; i < currentSelectedUnits.co_cu.length; i++)
    {
        totalUnits.co_cu.push(currentSelectedUnits.co_cu[i])
    }
    for(var j = 0; j < currentSelectedUnits.elective.length; j++)
    {
        totalUnits.elective.push(currentSelectedUnits.elective[j])
    }
    for(var k = 0; k < currentSelectedUnits.seElective.length; k++)
    {
        totalUnits.seElective.push(currentSelectedUnits.seElective[k])
    }

    for(var i = 0; i < currentStudiedUnits.co_cu.length; i++)
    {
        totalUnits.co_cu.push(currentStudiedUnits.co_cu[i])
    }
    for(var j = 0; j < currentStudiedUnits.elective.length; j++)
    {
        totalUnits.elective.push(currentStudiedUnits.elective[j])
    }
    for(var k = 0; k < currentStudiedUnits.seElective.length; k++)
    {
        totalUnits.seElective.push(currentStudiedUnits.seElective[k])
    }

    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    const detail = urlParams.get('detail');
    const student_status = urlParams.get('student_status');
    const spec_id = urlParams.get('spec_id');

    var file_name = '';

    if(detail == 'Semester One')
    {
        file_name = 'sem_1_units.json';
    } else if(detail == 'Semester Two')
    {
        file_name = 'sem_2_units.json';
    }

    function onBack() {
        window.location.href = "current2_detail.html?spec_id="+spec_id+"&detail="+detail+"&student_status="+student_status;
    }

    function showLegend(degree_id) {
        var appendLegend = '';
        if(degree_id == 1)
        {
            appendLegend += '<tr style="background-color: #211545; color: white;">';
            appendLegend += '<th>Legend</th>';
            appendLegend += '<th>CU = Common Unit</th>';
            appendLegend += '<th>CO = Core Unit</th>';
            appendLegend += '<th>SE = Specialist Elective</th>';
            appendLegend += '<th>E = Elective</th>';
            appendLegend += '</tr>';
        } else if(degree_id == 2)
        {
            appendLegend += '<tr style="background-color: #211545; color: white;">';
            appendLegend += '<th>Legend</th>';
            appendLegend += '<th>CO = Core Unit</th>';
            appendLegend += '<th>R = Research</th>';
            appendLegend += '<th>SE = Specialist Elective</th>';
            appendLegend += '</tr>';
        }
        
        $("#showLegend").append(appendLegend);
    }

    loadSpecDetails();

    function loadSpecDetails() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                data = JSON.parse(this.responseText);

                const filtered_data = data.filter(specializations => specializations.spec_id == spec_id);

                $("#currentDegree a").text(filtered_data[0].degree_title);
                var degree_url = "courses.html?degree_id="+filtered_data[0].degree_id;
                $("#currentDegree a").attr("href", degree_url);
                
                showLegend(filtered_data[0].degree_id);

                $("#currentCourse a").text(filtered_data[0].course_title);
                var course_url = "specializations.html?course_id="+filtered_data[0].course_id;
                $("#currentCourse a").attr("href", course_url);

                $("#currentSpecialization a").text(filtered_data[0].spec_title);
                var spec_url = "spec_details.html?spec_id="+filtered_data[0].spec_id;
                $("#currentSpecialization a").attr("href", spec_url);

                $("#currentSpecDetails a").text(detail);
                var spec_detail_url = "current_detail.html?spec_id="+spec_id+"&detail="+detail+"&student_status=Current Student";
                $("#currentSpecDetails a").attr("href", spec_detail_url);

                $('#currentStudentStatus').text(student_status);
                $('#currentStudentStatusTitle').text(student_status + ' - Unit Summary Report');

                
                // separating part
                var sem1_studied_data = [];
                var sem1_chosen_data = [];
                var sem1_remaining_data = [];
                var sem2_studied_data = [];
                var sem2_chosen_data = [];
                var sem2_remaining_data = [];

                for(i = 1; i <= filtered_data.length; i++)
                {
                    const yearly_data = filtered_data.filter(unit => unit.year == i)[0];

                    for(j = 0; j < yearly_data.units.length; j++)
                    {
                        var sem_1 = yearly_data.units[j].filter(unit => unit.semester == 1)[0];
                        var sem_2 = yearly_data.units[j].filter(unit => unit.semester == 2)[0];

                        // sem1
                        if((sem_1.type == "CU") | (sem_1.type == "CO") | (sem_1.type == "R"))
                        {
                            if(currentStudiedUnits.co_cu.includes(sem_1.code))
                            {
                                sem1_chosen_data.push(sem_1);
                            } 
                            else if(currentSelectedUnits.co_cu.includes(sem_1.code))
                            {
                                sem1_studied_data.push(sem_1);
                            }
                            else {
                                sem1_remaining_data.push(sem_1);
                            }
                        } else if (sem_1.type == "E")
                        {
                            var e_filtered_data = currentStudiedUnits.elective.filter(current => ((current.code == sem_1.code) & (current.year == i) & (current.semester == 1)));
                            var e_filtered_data2 = currentSelectedUnits.elective.filter(current => ((current.code == sem_1.code) & (current.year == i) & (current.semester == 1)));
                            if(e_filtered_data.length > 0)
                            {
                                e_filtered_data[0]["type"] = "E";
                                sem1_chosen_data.push(e_filtered_data[0]);
                            } 
                            else if(e_filtered_data2.length > 0)
                            {
                                e_filtered_data2[0]["type"] = "E";
                                sem1_studied_data.push(e_filtered_data2[0]);
                            }
                            else {
                                sem1_remaining_data.push(sem_1);
                            }
                        } else if (sem_1.type == "SE")
                        {
                            var se_filtered_data = currentStudiedUnits.seElective.filter(current => ((current.code == sem_1.code) & (current.year == i) & (current.semester == 1)));
                            var se_filtered_dat2 = currentSelectedUnits.seElective.filter(current => ((current.code == sem_1.code) & (current.year == i) & (current.semester == 1)));
                            if(se_filtered_data.length > 0)
                            {
                                se_filtered_data[0]["type"] = "SE";
                                sem1_chosen_data.push(se_filtered_data[0]);
                            }
                            else if(se_filtered_dat2.length > 0)
                            {
                                se_filtered_dat2[0]["type"] = "SE";
                                sem1_studied_data.push(se_filtered_dat2[0]);
                            }
                            else {
                                sem1_remaining_data.push(sem_1);
                            }
                        }
                        // sem1
                        
                        // sem2
                        if((sem_2.type == "CU") | (sem_2.type == "CO") | (sem_2.type == "R"))
                        {
                            if(currentStudiedUnits.co_cu.includes(sem_2.code))
                            {
                                sem2_chosen_data.push(sem_2);
                            }
                            else if(currentSelectedUnits.co_cu.includes(sem_2.code))
                            {
                                sem2_studied_data.push(sem_2);
                            } else {
                                sem2_remaining_data.push(sem_2);
                            }
                        } else if (sem_2.type == "E")
                        {
                            var e_filtered_data = currentStudiedUnits.elective.filter(current => ((current.code == sem_2.code) & (current.year == i) & (current.semester == 2)));
                            var e_filtered_data2 = currentSelectedUnits.elective.filter(current => ((current.code == sem_2.code) & (current.year == i) & (current.semester == 2)));
                            if(e_filtered_data.length > 0)
                            {
                                e_filtered_data[0]["type"] = "E";
                                sem2_chosen_data.push(e_filtered_data[0]);
                            } 
                            else if(e_filtered_data2.length > 0)
                            {
                                e_filtered_data2[0]["type"] = "E";
                                sem2_studied_data.push(e_filtered_data2[0]);
                            }
                            else {
                                sem2_remaining_data.push(sem_2);
                            }
                        } else if (sem_2.type == "SE")
                        {
                            var se_filtered_data = currentStudiedUnits.seElective.filter(current => ((current.code == sem_2.code) & (current.year == i) & (current.semester == 2)));
                            var se_filtered_data2 = currentSelectedUnits.seElective.filter(current => ((current.code == sem_2.code) & (current.year == i) & (current.semester == 2)));
                            if(se_filtered_data.length > 0)
                            {
                                se_filtered_data[0]["type"] = "SE";
                                sem2_chosen_data.push(se_filtered_data[0]);
                            } 
                            else if(se_filtered_data2.length > 0) {
                                se_filtered_data2[0]["type"] = "SE";
                                sem2_studied_data.push(se_filtered_data2[0]);
                            }
                            else {
                                sem2_remaining_data.push(sem_2);
                            }
                        }
                        // sem2
                    }
                }

                // Studied
                var appendStudiedTr = '';
                if(sem1_studied_data.length > 0)
                {
                    appendStudiedTr += '<tr style="background-color: #dc8633">'; 
                    appendStudiedTr += '<td colspan="2">Semester One</td>';
                    appendStudiedTr += '</tr>'; 

                    appendStudiedTr += '<tr class="no-wrap" style="background-color: #211545; color: white;">';
                    appendStudiedTr += '<td>Units</td>';
                    appendStudiedTr += '<td>Legend</td>';
                    appendStudiedTr += '</tr>';

                    for(var x= 0; x < sem1_studied_data.length; x++)
                    {  
                        appendStudiedTr += '<tr>';    

                        if((sem1_studied_data[x].type == "CU") | (sem1_studied_data[x].type == "CO") | (sem1_studied_data[x].type == "R"))
                        { 
                            var prerequisite = 'No Prerequisites';
                            if (sem1_studied_data[x].prerequisite.length > 0)
                            {
                                prerequisite = 'Prerequisites: ' + sem1_studied_data[x].prerequisite.join();
                            }
                            appendStudiedTr += '<td style="background: #bed8ff;">';
                            appendStudiedTr += '<a data-toggle="tooltip" data-placement="top" title="'+ prerequisite +'">';
                            appendStudiedTr += '<strong>'+ sem1_studied_data[x].code +'</strong> <br>';
                            appendStudiedTr += '</a>';
                            appendStudiedTr += sem1_studied_data[x].title;
                            appendStudiedTr += '</td>';
                            appendStudiedTr += '<td class="align-middle" style="background: #bed8ff;">'+ sem1_studied_data[x].type +'</td>';
                        } else if (sem1_studied_data[x].type == "E")
                        {
                            appendStudiedTr += '<td style="background: #bed8ff;">';
                            appendStudiedTr += '<strong class="replaceElective">'+ sem1_studied_data[x].unit +'</strong>';
                            appendStudiedTr += '</td>';
                            appendStudiedTr += '<td class="align-middle" style="background: #bed8ff;">'+ sem1_studied_data[x].type +'</td>';
                        } else if (sem1_studied_data[x].type == "SE"){
                            appendStudiedTr += '<td style="background: #bed8ff;">';
                            appendStudiedTr += '<strong class="replaceSEElective">'+ sem1_studied_data[x].unit +'</strong>';
                            appendStudiedTr += '</td>';
                            appendStudiedTr += '<td class="align-middle" style="background: #bed8ff;">'+ sem1_studied_data[x].type +'</td>';
                        }
                        
                        appendStudiedTr += '</tr>';
                    }
                }

                if (sem2_studied_data.length > 0)
                {
                    appendStudiedTr += '<tr style="background-color: #dc8633">'; 
                    appendStudiedTr += '<td colspan="2">Semester Two</td>';
                    appendStudiedTr += '</tr>'; 

                    appendStudiedTr += '<tr class="no-wrap" style="background-color: #211545; color: white;">';
                    appendStudiedTr += '<td>Units</td>';
                    appendStudiedTr += '<td>Legend</td>';
                    appendStudiedTr += '</tr>';
                    
                    for(var x= 0; x < sem2_studied_data.length; x++)
                    {      
                        appendStudiedTr += '<tr>';

                        if((sem2_studied_data[x].type == "CU") | (sem2_studied_data[x].type == "CO") | (sem2_studied_data[x].type == "R"))
                        { 
                            var prerequisite = 'No Prerequisites';
                            if (sem2_studied_data[x].prerequisite.length > 0)
                            {
                                prerequisite = 'Prerequisites: ' + sem2_studied_data[x].prerequisite.join();
                            }
                            appendStudiedTr += '<td style="background: #bed8ff;">';
                            appendStudiedTr += '<a data-toggle="tooltip" data-placement="top" title="'+ prerequisite +'">';
                            appendStudiedTr += '<strong>'+ sem2_studied_data[x].code +'</strong> <br>';
                            appendStudiedTr += '</a>';
                            appendStudiedTr += sem2_studied_data[x].title;
                            appendStudiedTr += '</td>';
                            appendStudiedTr += '<td class="align-middle" style="background: #bed8ff;">'+ sem2_studied_data[x].type +'</td>';
                        } else if (sem2_studied_data[x].type == "E")
                        {
                            appendStudiedTr += '<td style="background: #bed8ff;">';
                            appendStudiedTr += '<strong class="replaceElective">'+ sem2_studied_data[x].unit +'</strong>';
                            appendStudiedTr += '</td>';
                            appendStudiedTr += '<td class="align-middle" style="background: #bed8ff;">'+ sem2_studied_data[x].type +'</td>';
                        } else if (sem2_studied_data[x].type == "SE"){
                            appendStudiedTr += '<td style="background: #bed8ff;">';
                            appendStudiedTr += '<strong class="replaceSEElective">'+ sem2_studied_data[x].unit +'</strong>';
                            appendStudiedTr += '</td>';
                            appendStudiedTr += '<td class="align-middle" style="background: #bed8ff;">'+ sem2_studied_data[x].type +'</td>';
                        }
                        
                        appendStudiedTr += '</tr>';
                    }
                }

                $("#studiedTable").append(appendStudiedTr);

                
                // Chosen
                var appendChosenTr = '';
                if(sem1_chosen_data.length > 0)
                {
                    appendChosenTr += '<tr style="background-color: #dc8633">'; 
                    appendChosenTr += '<td colspan="2">Semester One</td>';
                    appendChosenTr += '</tr>'; 

                    appendChosenTr += '<tr class="no-wrap" style="background-color: #211545; color: white;">';
                    appendChosenTr += '<td>Units</td>';
                    appendChosenTr += '<td>Legend</td>';
                    appendChosenTr += '</tr>';

                    for(var x= 0; x < sem1_chosen_data.length; x++)
                    {  
                        appendChosenTr += '<tr>';    

                        if((sem1_chosen_data[x].type == "CU") | (sem1_chosen_data[x].type == "CO") | (sem1_chosen_data[x].type == "R"))
                        { 
                            var prerequisite = 'No Prerequisites';
                            if (sem1_chosen_data[x].prerequisite.length > 0)
                            {
                                prerequisite = 'Prerequisites: ' + sem1_chosen_data[x].prerequisite.join();
                            }
                            appendChosenTr += '<td style="background: #bcffc1;">';
                            appendChosenTr += '<a data-toggle="tooltip" data-placement="top" title="'+ prerequisite +'">';
                            appendChosenTr += '<strong>'+ sem1_chosen_data[x].code +'</strong> <br>';
                            appendChosenTr += '</a>';
                            appendChosenTr += sem1_chosen_data[x].title;
                            appendChosenTr += '</td>';
                            appendChosenTr += '<td class="align-middle" style="background: #bcffc1;">'+ sem1_chosen_data[x].type +'</td>';
                        } else if (sem1_chosen_data[x].type == "E")
                        {
                            appendChosenTr += '<td style="background: #bcffc1;">';
                            appendChosenTr += '<strong class="replaceElective">'+ sem1_chosen_data[x].unit +'</strong>';
                            appendChosenTr += '</td>';
                            appendChosenTr += '<td class="align-middle" style="background: #bcffc1;">'+ sem1_chosen_data[x].type +'</td>';
                        } else if (sem1_chosen_data[x].type == "SE"){
                            appendChosenTr += '<td style="background: #bcffc1;">';
                            appendChosenTr += '<strong class="replaceSEElective">'+ sem1_chosen_data[x].unit +'</strong>';
                            appendChosenTr += '</td>';
                            appendChosenTr += '<td class="align-middle" style="background: #bcffc1;">'+ sem1_chosen_data[x].type +'</td>';
                        }
                        
                        appendChosenTr += '</tr>';
                    }
                }

                if (sem2_chosen_data.length > 0)
                {
                    appendChosenTr += '<tr style="background-color: #dc8633">'; 
                    appendChosenTr += '<td colspan="2">Semester Two</td>';
                    appendChosenTr += '</tr>'; 

                    appendChosenTr += '<tr class="no-wrap" style="background-color: #211545; color: white;">';
                    appendChosenTr += '<td>Units</td>';
                    appendChosenTr += '<td>Legend</td>';
                    appendChosenTr += '</tr>';
                    
                    for(var x= 0; x < sem2_chosen_data.length; x++)
                    {      
                        appendChosenTr += '<tr>';

                        if((sem2_chosen_data[x].type == "CU") | (sem2_chosen_data[x].type == "CO") | (sem2_chosen_data[x].type == "R"))
                        { 
                            var prerequisite = 'No Prerequisites';
                            if (sem2_chosen_data[x].prerequisite.length > 0)
                            {
                                prerequisite = 'Prerequisites: ' + sem2_chosen_data[x].prerequisite.join();
                            }
                            appendChosenTr += '<td style="background: #bcffc1;">';
                            appendChosenTr += '<a data-toggle="tooltip" data-placement="top" title="'+ prerequisite +'">';
                            appendChosenTr += '<strong>'+ sem2_chosen_data[x].code +'</strong> <br>';
                            appendChosenTr += '</a>';
                            appendChosenTr += sem2_chosen_data[x].title;
                            appendChosenTr += '</td>';
                            appendChosenTr += '<td class="align-middle" style="background: #bcffc1;">'+ sem2_chosen_data[x].type +'</td>';
                        } else if (sem2_chosen_data[x].type == "E")
                        {
                            appendChosenTr += '<td style="background: #bcffc1;">';
                            appendChosenTr += '<strong class="replaceElective">'+ sem2_chosen_data[x].unit +'</strong>';
                            appendChosenTr += '</td>';
                            appendChosenTr += '<td class="align-middle" style="background: #bcffc1;">'+ sem2_chosen_data[x].type +'</td>';
                        } else if (sem2_chosen_data[x].type == "SE"){
                            appendChosenTr += '<td style="background: #bcffc1;">';
                            appendChosenTr += '<strong class="replaceSEElective">'+ sem2_chosen_data[x].unit +'</strong>';
                            appendChosenTr += '</td>';
                            appendChosenTr += '<td class="align-middle" style="background: #bcffc1;">'+ sem2_chosen_data[x].type +'</td>';
                        }
                        
                        appendChosenTr += '</tr>';
                    }
                }

                $("#chosenTable").append(appendChosenTr);

                // Remaining

                sem1_remaining_data = chunk(sem1_remaining_data, 4);
                sem2_remaining_data = chunk(sem2_remaining_data, 4);
                
                var sem1_last_units = sem1_remaining_data[sem1_remaining_data.length - 1];
                var sem2_last_units = sem2_remaining_data[sem2_remaining_data.length - 1];
                
                var max_count = sem1_remaining_data.length;
                if(max_count < sem2_remaining_data.length)
                {
                    max_count = sem2_remaining_data.length;
                }


                //////sdfsdaflsdkfsda
                // fasdfsadf

                appendRemainingTr = '';
                var year = 1;
                var electiveTags = [];
                var seElectiveTags_sem_1 = [];
                var seElectiveTags_sem_2 = [];
                var sem1_choose_elective_notify = true;
                var sem2_choose_elective_notify = true;
                for(i=0; i < max_count; i++)
                {
                    appendRemainingTr += '<tr class="no-wrap" style="background-color: #211545; color: white;">';
                    appendRemainingTr += '<td>Year '+ (i+1) +'</td>';
                    appendRemainingTr += '<td>Legend</td>';
                    appendRemainingTr += '<td>Year '+ (i+1) +'</td>';
                    appendRemainingTr += '<td>Legend</td>';
                    appendRemainingTr += '</tr>';
                    
                    var sem_count = 0;
                    if(i < sem1_remaining_data.length)
                    {
                        sem_count = sem1_remaining_data[i].length;
                    }
                    
                    if((i < sem2_remaining_data.length) && (sem_count < sem2_remaining_data[i].length))
                    {
                        sem_count = sem2_remaining_data[i].length;
                    }

                    for(j=0; j < sem_count; j++)
                    {
                        appendRemainingTr += '<tr>';

                        //sem1
                        if((i < sem1_remaining_data.length) && (j < sem1_remaining_data[i].length))
                        {
                            semester = 1;
                            year = j + 1;
                            var prerequisite = 'No Prerequisites';
                            if (sem1_remaining_data[i][j].prerequisite.length > 0)
                            {
                                prerequisite = 'Prerequisites: ' + sem1_remaining_data[i][j].prerequisite.join();
                            }

                            var electiveTag = '';
                            var seElectiveTag = '';

                            if((sem1_remaining_data[i][j].type == "CU") | (sem1_remaining_data[i][j].type == "CO") | (sem1_remaining_data[i][j].type == "R"))
                            {
                                if (sem1_remaining_data[i][j].prerequisite.every(r=> totalUnits.co_cu.includes(r)))
                                {
                                    appendRemainingTr += '<td>';
                                    appendRemainingTr += '<a data-toggle="tooltip" data-placement="top" title="'+ prerequisite +'">';
                                    appendRemainingTr += '<strong>'+ sem1_remaining_data[i][j].code +'</strong> <br>';
                                    appendRemainingTr += sem1_remaining_data[i][j].title;
                                    appendRemainingTr += '</a>';
                                    appendRemainingTr += '</td>';
                                    appendRemainingTr += '<td class="align-middle">'+ sem1_remaining_data[i][j].type +'</td>';
                                } else {
                                    appendRemainingTr += '<td style="background: #ffd9b1;">';
                                    appendRemainingTr += '<a data-toggle="tooltip" data-placement="top" title="'+ prerequisite +'">';
                                    appendRemainingTr += '<strong>'+ sem1_remaining_data[i][j].code +'</strong> <br>';
                                    appendRemainingTr += '</a>';
                                    appendRemainingTr += sem1_remaining_data[i][j].title;
                                    appendRemainingTr += '</td>';
                                    appendRemainingTr += '<td class="align-middle" style="background: #ffd9b1;">'+ sem1_remaining_data[i][j].type +'</td>';
                                }
                                
                            } else if (sem1_remaining_data[i][j].type == "E")
                            {
                                electiveTag = '#elective_'+ year +'_'+ semester +'_'+ sem1_remaining_data[i][j].code;
                                electiveTags.push(electiveTag);

                                appendRemainingTr += '<td>';
                                appendRemainingTr += '<input class="form-control" id="elective_'+ year +'_'+ semester +'_'+ sem1_remaining_data[i][j].code +'" placeholder="Select an Elective">';
                                appendRemainingTr += '</td>';
                                appendRemainingTr += '<td>E</td>';
                            } else if (sem1_remaining_data[i][j].type == "SE")
                            {
                                seElectiveTag = '#seElective_'+ year +'_'+ semester +'_'+ sem1_remaining_data[i][j].code;
                                seElectiveTags_sem_1.push(seElectiveTag);
                                
                                appendRemainingTr += '<td>';
                                appendRemainingTr += '<select class="form-control" id="seElective_'+ year +'_'+ semester +'_'+ sem1_remaining_data[i][j].code +'">';
                                appendRemainingTr += '<option value="default_value">Select Special Elective</option>';
                                appendRemainingTr += '</select>';
                                appendRemainingTr += '</td>';
                                appendRemainingTr += '<td>SE</td>';
                            }
                        } else {
                            if(sem1_choose_elective_notify)
                            {
                                appendRemainingTr += "<td style='color: rgb(255, 0, 0);'>You can also choose electives from semester Two.</td>";
                                sem1_choose_elective_notify = false;
                            }
                            else
                                appendRemainingTr += "<td></td>";

                            appendRemainingTr += "<td></td>";
                        }

                        //sem2
                        if((i < sem2_remaining_data.length) && (j < sem2_remaining_data[i].length))
                        {
                            semester = 2;
                            year = j + 1;
                            var prerequisite = 'No Prerequisites';
                            if (sem2_remaining_data[i][j].prerequisite.length > 0)
                            {
                                prerequisite = 'Prerequisites: ' + sem2_remaining_data[i][j].prerequisite.join();
                            }

                            var electiveTag = '';
                            var seElectiveTag = '';

                            if((sem2_remaining_data[i][j].type == "CU") | (sem2_remaining_data[i][j].type == "CO") | (sem2_remaining_data[i][j].type == "R"))
                            {
                                if (sem2_remaining_data[i][j].prerequisite.every(r=> currentStudiedUnits.co_cu.includes(r)))
                                {
                                    appendRemainingTr += '<td>';
                                    appendRemainingTr += '<a data-toggle="tooltip" data-placement="top" title="'+ prerequisite +'">';
                                    appendRemainingTr += '<strong>'+ sem2_remaining_data[i][j].code +'</strong> <br>';
                                    appendRemainingTr += sem2_remaining_data[i][j].title;
                                    appendRemainingTr += '</a>';
                                    appendRemainingTr += '</td>';
                                    appendRemainingTr += '<td class="align-middle">'+ sem2_remaining_data[i][j].type +'</td>';
                                } else {
                                    appendRemainingTr += '<td style="background: #ffd9b1;">';
                                    appendRemainingTr += '<a data-toggle="tooltip" data-placement="top" title="'+ prerequisite +'">';
                                    appendRemainingTr += '<strong>'+ sem2_remaining_data[i][j].code +'</strong> <br>';
                                    appendRemainingTr += '</a>';
                                    appendRemainingTr += sem2_remaining_data[i][j].title;
                                    appendRemainingTr += '</td>';
                                    appendRemainingTr += '<td class="align-middle" style="background: #ffd9b1;">'+ sem2_remaining_data[i][j].type +'</td>';
                                }
                                
                            } else if (sem2_remaining_data[i][j].type == "E")
                            {
                                electiveTag = '#elective_'+ year +'_'+ semester +'_'+ sem2_remaining_data[i][j].code;
                                electiveTags.push(electiveTag);

                                appendRemainingTr += '<td>';
                                appendRemainingTr += '<input class="form-control" id="elective_'+ year +'_'+ semester +'_'+ sem2_remaining_data[i][j].code +'" placeholder="Select an Elective">';
                                appendRemainingTr += '</td>';
                                appendRemainingTr += '<td>E</td>';
                            } else if (sem2_remaining_data[i][j].type == "SE")
                            {
                                seElectiveTag = '#seElective_'+ year +'_'+ semester +'_'+ sem2_remaining_data[i][j].code;
                                seElectiveTags_sem_2.push(seElectiveTag);
                                
                                appendRemainingTr += '<td>';
                                appendRemainingTr += '<select class="form-control" id="seElective_'+ year +'_'+ semester +'_'+ sem2_remaining_data[i][j].code +'">';
                                appendRemainingTr += '<option value="default_value">Select Special Elective</option>';
                                appendRemainingTr += '</select>';
                                appendRemainingTr += '</td>';
                                appendRemainingTr += '<td>SE</td>';
                            }
                        } else {
                            if(sem2_choose_elective_notify)
                            {
                                appendRemainingTr += "<td style='color: rgb(255, 0, 0);'>You can also choose electives from semester One.</td>";
                                sem2_choose_elective_notify = false;
                            }
                            else
                                appendRemainingTr += "<td></td>";

                            appendRemainingTr += "<td></td>";
                        }

                        appendRemainingTr += '</tr>';
                    }
                }

                $("#remainingTable").append(appendRemainingTr);

                // separating part

                loadElectives(electiveTags.join());

                loadSpecializedElectives(spec_id, 'sem_1', seElectiveTags_sem_1.join());

                loadSpecializedElectives(spec_id, 'sem_2', seElectiveTags_sem_2.join());

                $('[data-toggle="tooltip"]').tooltip();

            }
        };
        xhttp.open("GET", file_name, true);
        xhttp.send();
    }

    const chunk = (arr, size) => Array.from({ length: Math.ceil(arr.length / size) }, (v, i) =>
        arr.slice(i * size, i * size + size)
    );

    function loadSpecializedElectives(spec_id, detail, seElectiveTags) {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                data = JSON.parse(this.responseText);

                var semester = 0;
                if(detail == 'sem_1')
                {
                    semester = 1;
                } else if(detail == 'sem_2')
                {
                    semester = 2;
                }

                const filtered_data = data.filter(specializations => (specializations.spec_id == spec_id) & (specializations.semester == semester))[0];

                if(filtered_data)
                {
                    replaceSEElectiveLoop:
                    for(i = 0; i < filtered_data.special_electives.length; i++)
                    {
                        var replaceSEElective = document.getElementsByClassName("replaceSEElective");
                        for(var j = 0; j < replaceSEElective.length; j++)
                        {
                            var compareData = filtered_data.special_electives[i].title.split(':')[0];

                            if(replaceSEElective[j].innerHTML == compareData){
                                replaceSEElective[j].insertAdjacentHTML("afterend", "<br>" + filtered_data.special_electives[i].title.split(':')[1]);
                                continue replaceSEElectiveLoop;
                            }
                        }
                        
                        var seElective = [];
                        for(var k = 0; k < totalUnits.seElective.length; k++)
                        {
                            seElective.push(totalUnits.seElective[k].unit);
                        }
                        for(var l = 0; l < totalUnits.elective.length; l++)
                        {
                            seElective.push(totalUnits.elective[l].unit);
                        }
                        for(var m = 0; m < totalUnits.co_cu.length; m++)
                        {
                            seElective.push(totalUnits.co_cu[m]);
                        }
                        if (!(filtered_data.special_electives[i].prerequisite.every(r=> seElective.includes(r))))
                            continue

                        $(seElectiveTags).append($('<option>',
                            {
                                value: filtered_data.special_electives[i].code,
                                text: filtered_data.special_electives[i].title
                            }
                        ));
                    }
                }
            }
        };
        xhttp.open("GET", 'specialized_electives.json', true);
        xhttp.send();
    }

    function loadElectives(electiveTags) {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                var data = JSON.parse(this.responseText);

                var replaceElective = document.getElementsByClassName("replaceElective");
                for(var j = 0; j < replaceElective.length; j++)
                {
                    var filtered_data = data.filter(datum => datum.split(':')[0] == replaceElective[j].innerHTML)[0];

                    replaceElective[j].insertAdjacentHTML("afterend", "<br>" + filtered_data.split(':')[1]);

                    data = data.filter(datum => datum != filtered_data);
                }

                $(electiveTags).autocomplete({
                    source: data
                });
            }
        };
        xhttp.open("GET", 'electives.json', true);
        xhttp.send();
    }

    loadSpecializations();
    function loadSpecializations(electiveTags) {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                var data = JSON.parse(this.responseText);

                var filtered_data = data.filter(datum => datum.spec_id == spec_id)[0];

                var courseSummaryHead = '';
                var courseSummaryBody = '';
                if(filtered_data.degree_id == 1)
                {
                    var level100 = 0;
                    var level200 = 0;
                    var level300 = 0;

                    for(var i = 0; i < totalUnits.co_cu.length; i++)
                    {
                        var level_data = filtered_data.course_summary.filter(cs => cs.unit == totalUnits.co_cu[i])[0];

                        if (level_data.level_title == "Level 100")
                            level100 += level_data.credit;
                        if (level_data.level_title == "Level 200")
                            level200 += level_data.credit;
                        if (level_data.level_title == "Level 300 or above")
                            level300 += level_data.credit; 
                    }

                    var elective = 10 * totalUnits.elective.length;
                    var seElective = 10 * totalUnits.seElective.length;
                    
                    courseSummaryHead += '<tr class="no-wrap" style="background-color: #007a87; color: white;">';
                    courseSummaryHead += '<th>Total Credit</th>';
                    courseSummaryHead += '<th>Level 100</th>';
                    courseSummaryHead += '<th>Level 200</th>';
                    courseSummaryHead += '<th>Level 300 or above</th>';
                    courseSummaryHead += '<th>Specialist Elective</th>';
                    courseSummaryHead += '<th>Elective</th>';
                    courseSummaryHead += '<th>Total Remaining</th>';
                    courseSummaryHead += '</tr>';

                    courseSummaryBody += '<tr style="background-color: #FCFFFF">';
                    courseSummaryBody += '<td>'+ filtered_data.total_credit +'</td>';
                    courseSummaryBody += '<td>'+ level100 +'</td>';
                    courseSummaryBody += '<td>'+ level200 +'</td>';
                    courseSummaryBody += '<td>'+ level300 +'</td>';
                    courseSummaryBody += '<td>'+ seElective +'</td>';
                    courseSummaryBody += '<td>'+ elective +'</td>';
                    courseSummaryBody += '<td>'+ (filtered_data.total_credit - level100 - level200 - level300 - seElective - elective) +'</td>';
                    courseSummaryBody += '</tr>';

                    $("#courseSummaryHead").append(courseSummaryHead);
                    $("#courseSummaryBody").append(courseSummaryBody);
                } else if (filtered_data.degree_id == 2){
                    var level100 = 0;
                    var level200 = 0;
                    var level300 = 0;
                    var masterThesis = 0;

                    for(var i = 0; i < totalUnits.co_cu.length; i++)
                    {
                        var level_data = filtered_data.course_summary.filter(cs => cs.unit == totalUnits.co_cu[i])[0];

                        if (level_data.level_title == "Level 100")
                            level100 += level_data.credit;
                        if (level_data.level_title == "Level 200")
                            level200 += level_data.credit;
                        if (level_data.level_title == "Level 300 or above")
                            level300 += level_data.credit; 
                        if (level_data.level_title == "Master Thesis")
                            masterThesis += level_data.credit; 
                    }

                    var elective = 10 * totalUnits.elective.length;
                    var seElective = 10 * totalUnits.seElective.length;
                    
                    courseSummaryHead += '<tr class="no-wrap" style="background-color: #007a87; color: white;">';
                    courseSummaryHead += '<th>Total Credit</th>';
                    courseSummaryHead += '<th>Level 100</th>';
                    courseSummaryHead += '<th>Level 200</th>';
                    courseSummaryHead += '<th>Level 300 or above</th>';
                    courseSummaryHead += '<th>Specialist Elective</th>';
                    courseSummaryHead += '<th>Master Thesis</th>';
                    courseSummaryHead += '<th>Total Remaining</th>';
                    courseSummaryHead += '</tr>';

                    courseSummaryBody += '<tr style="background-color: #FCFFFF">';
                    courseSummaryBody += '<td>'+ filtered_data.total_credit +'</td>';
                    courseSummaryBody += '<td>'+ level100 +'</td>';
                    courseSummaryBody += '<td>'+ level200 +'</td>';
                    courseSummaryBody += '<td>'+ level300 +'</td>';
                    courseSummaryBody += '<td>'+ seElective +'</td>';
                    courseSummaryBody += '<td>'+ masterThesis +'</td>';
                    courseSummaryBody += '<td>'+ (filtered_data.total_credit - level100 - level200 - level300 - seElective - masterThesis) +'</td>';
                    courseSummaryBody += '</tr>';

                    $("#courseSummaryHead").append(courseSummaryHead);
                    $("#courseSummaryBody").append(courseSummaryBody);
                }

                var seElective = [];
                var countCondition = 0;
                for(var k = 0; k < totalUnits.seElective.length; k++)
                {
                    if (filtered_data.prerequisites[0].units.filter(unit => unit == totalUnits.seElective[k].unit).length > 0)
                        countCondition = countCondition + 1;
                }

                if(filtered_data.prerequisites.length > 0)
                {
                    if(countCondition < filtered_data.prerequisites[0].condition) {
                        $('#alertSE').html(filtered_data.prerequisites[0].title);
                        $("#alertSE").css({"color": "red"});
                    } else {
                        $('#alertSE').html(filtered_data.prerequisites[0].match_title);
                        $("#alertSE").css({"color": "#5cb85"});
                    }
                }
            }
        };
        xhttp.open("GET", 'specializations.json', true);
        xhttp.send();
    }

</script>

</body>
</html>